name: Versionamento AutomÃ¡tico

on:
  push:
    branches:
      - main

jobs:
  versionar:
    name: Gerar VersÃ£o AutomÃ¡tica
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout do cÃ³digo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Configurar Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
      
      - name: Gerar nova versÃ£o
        id: versao
        uses: mathieudutour/github-tag-action@v6.2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          default_bump: patch
          release_branches: main
          pre_release_branches: develop
          tag_prefix: v
          custom_release_rules: |
            feat:minor:Novas Funcionalidades
            fix:patch:CorreÃ§Ãµes de Bugs
            docs:patch:DocumentaÃ§Ã£o
            style:patch:FormataÃ§Ã£o
            refactor:patch:RefatoraÃ§Ã£o
            perf:patch:Performance
            test:patch:Testes
            build:patch:Build
            ci:patch:CI/CD
            chore:patch:ManutenÃ§Ã£o
      
      - name: Resumo da VersÃ£o
        if: steps.versao.outputs.new_tag
        run: |
          echo "### ðŸ·ï¸ Nova VersÃ£o Criada! âœ…" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**VersÃ£o:** \`${{ steps.versao.outputs.new_tag }}\`" >> $GITHUB_STEP_SUMMARY
          echo "**VersÃ£o Anterior:** \`${{ steps.versao.outputs.previous_tag }}\`" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Changelog:**" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "${{ steps.versao.outputs.changelog }}" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Build Docker serÃ¡ executado automaticamente!**" >> $GITHUB_STEP_SUMMARY
      
      - name: Nenhuma mudanÃ§a
        if: steps.versao.outputs.new_tag == ''
        run: |
          echo "### â„¹ï¸ Nenhuma Nova VersÃ£o" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Nenhuma mudanÃ§a significativa detectada desde a Ãºltima versÃ£o." >> $GITHUB_STEP_SUMMARY
